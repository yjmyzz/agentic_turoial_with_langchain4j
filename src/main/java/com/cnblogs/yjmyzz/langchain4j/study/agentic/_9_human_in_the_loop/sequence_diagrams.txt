sequenceDiagram
    participant Main as Main Class (_9a_HumanInTheLoop_Simple_Validator)
    participant Context as Spring Context
    participant Model as ChatModel
    participant RagProvider as RagProvider
    participant DecisionProposer as HiringDecisionProposer
    participant HumanValidator as Human Validator
    participant InterviewAgent as InterviewOrganizer
    participant EmailAgent as EmailAssistant
    participant HoldOnAgent as HoldOnAssist
    participant ConditionalAgent as Conditional Agent
    participant OrganizingTools as OrganizingTools
    participant CandidateData as Candidate Data

    Main->>Context: Load Spring Application Context
    Context-->>Main: Return ChatModel & RagProvider
    Main->>Model: Get Ollama Chat Model
    Main->>RagProvider: Get Rag Provider

    Main->>DecisionProposer: Build HiringDecisionProposer with model
    Main->>InterviewAgent: Build InterviewOrganizer with RagProvider & OrganizingTools
    Main->>EmailAgent: Build EmailAssistant with OrganizingTools
    Main->>HumanValidator: Build HumanInTheLoop validator

    Main->>DecisionProposer: Prepare input with CvReview data
    DecisionProposer-->>Main: Return model decision

    Main->>HumanValidator: Request human validation
    HumanValidator->>HumanValidator: Print AI suggestion to console
    HumanValidator->>HumanValidator: Wait for user input (I/R/H)
    HumanValidator-->>Main: Return final decision from human

    Main->>ConditionalAgent: Build conditional agent based on human decision
    Note over ConditionalAgent: If decision contains 'I' -> InterviewOrganizer
    Note over ConditionalAgent: If decision contains 'R' -> EmailAssistant
    Note over ConditionalAgent: If decision contains 'H' -> HoldOnAssist

    Main->>CandidateData: Load candidate contact and job description
    CandidateData-->>Main: Return candidateContact and jobDescription

    Main->>ConditionalAgent: Invoke with arguments (candidateContact, jobDescription)
    alt Final Decision is Invite (I)
        ConditionalAgent->>InterviewAgent: Route to InterviewOrganizer
        InterviewAgent->>OrganizingTools: Call tools to schedule interview
        OrganizingTools->>OrganizingTools: getCurrentDate()
        OrganizingTools->>OrganizingTools: getInvolvedEmployeesForInterview()
        OrganizingTools->>OrganizingTools: createCalendarEntry()
        OrganizingTools->>OrganizingTools: sendEmail()
        OrganizingTools->>OrganizingTools: updateApplicationStatus()
        InterviewAgent-->>ConditionalAgent: Return organization result
    else Final Decision is Reject (R)
        ConditionalAgent->>EmailAgent: Route to EmailAssistant
        EmailAgent->>OrganizingTools: Call tools to send rejection email
        OrganizingTools->>OrganizingTools: sendEmail()
        OrganizingTools->>OrganizingTools: updateApplicationStatus()
        EmailAgent-->>ConditionalAgent: Return email result
    else Final Decision is Hold On (H)
        ConditionalAgent->>HoldOnAgent: Route to HoldOnAssist
        HoldOnAgent-->>ConditionalAgent: Return hold on message
    end
    ConditionalAgent-->>Main: Complete workflow