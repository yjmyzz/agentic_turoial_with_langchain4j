# 复合工作流时序图

## 候选人工作流部分

```mermaid
sequenceDiagram
    participant Main as 主程序
    participant CandidateWorkflow as CandidateWorkflow
    participant CvGenerator as CvGenerator
    participant CvReviewer as CvReviewer
    participant CvImprovementLoop as 简历改进循环
    participant ScoredCvTailor as ScoredCvTailor
    
    Main->>CandidateWorkflow: processCandidate(个人履历, 职位描述)
    CandidateWorkflow->>CvGenerator: 生成简历
    CvGenerator-->>CandidateWorkflow: 返回简历
    CandidateWorkflow->>CvReviewer: 评审简历
    CvReviewer-->>CandidateWorkflow: 返回评审结果
    CandidateWorkflow->>CvImprovementLoop: 启动简历改进循环
    loop 简历评分 < 0.8
        CvImprovementLoop->>ScoredCvTailor: 根据评分调整简历
        ScoredCvTailor-->>CvImprovementLoop: 返回调整后的简历
        CvImprovementLoop->>CvReviewer: 重新评审
        CvReviewer-->>CvImprovementLoop: 返回新的评审
        alt 评分 >= 0.8
            CvImprovementLoop-->>CandidateWorkflow: 返回最终简历
        end
    end
    CandidateWorkflow-->>Main: 返回最终简历
```

## 招聘团队工作流部分

```mermaid
sequenceDiagram
    participant Main as 主程序
    participant HiringTeamWorkflow as 招聘团队工作流
    participant ParallelReview as 并行评审工作流
    participant HRReviewer as HR评审员
    participant ManagerReviewer as 经理评审员
    participant TeamMemberReviewer as 团队成员评审员
    participant DecisionWorkflow as 决策工作流
    participant InterviewOrganizer as 面试组织者
    participant EmailAssistant as 邮件助手
    
    Main->>HiringTeamWorkflow: invoke(候选人数据)
    HiringTeamWorkflow->>ParallelReview: 启动并行评审
    parallel
        ParallelReview->>HRReviewer: HR评审
        HRReviewer-->>ParallelReview: HR评审结果
        
        ParallelReview->>ManagerReviewer: 经理评审
        ManagerReviewer-->>ParallelReview: 经理评审结果
        
        ParallelReview->>TeamMemberReviewer: 团队成员评审
        TeamMemberReviewer-->>ParallelReview: 团队成员评审结果
    end
    ParallelReview-->>HiringTeamWorkflow: 返回合并的评审结果
    HiringTeamWorkflow->>DecisionWorkflow: 条件决策
    alt 平均评分 >= 0.8
        DecisionWorkflow->>InterviewOrganizer: 安排面试
        InterviewOrganizer-->>DecisionWorkflow: 面试安排确认
        DecisionWorkflow-->>HiringTeamWorkflow: 决策结果(邀请)
    else 平均评分 < 0.8
        DecisionWorkflow->>EmailAssistant: 发送拒绝邮件
        EmailAssistant-->>DecisionWorkflow: 邮件发送确认
        DecisionWorkflow-->>HiringTeamWorkflow: 决策结果(拒绝)
    end
    HiringTeamWorkflow-->>Main: 工作流完成
```

## 整体复合工作流

```mermaid
sequenceDiagram
    participant User as 用户/主程序
    participant CandidateWF as 候选人工作流
    participant HiringTeamWF as 招聘团队工作流
    participant CVGen as 简历生成器
    participant CVRevLoop as 简历评审循环
    participant ParallelRev as 并行评审
    participant CondDec as 条件决策
    
    User->>CandidateWF: 开始候选人流程
    Note over CandidateWF: 包含简历生成、评审、循环改进
    CandidateWF-->>User: 返回最终简历
    User->>HiringTeamWF: 开始招聘团队流程
    Note over HiringTeamWF: 包含并行评审和条件决策
    HiringTeamWF-->>User: 完成招聘决策
```